# 🚀 クイックスタート - 毎日7時・20時の自動配信設定

## 5分でできる設定手順

### ステップ1: 環境変数の確認（1分）

`.env` ファイルを開いて、以下が設定されているか確認：

```env
GMAIL_USER=your-email@gmail.com
GMAIL_APP_PASSWORD=xxxx xxxx xxxx xxxx
NEWSLETTER_TO=recipient@example.com
ANTHROPIC_API_KEY=sk-ant-xxxxx
```

💡 **Gmailアプリパスワードの取得方法**:
1. https://myaccount.google.com/ にアクセス
2. セキュリティ → 2段階認証を有効化
3. セキュリティ → アプリパスワード → 新しいアプリパスワードを生成

---

### ステップ2: 動作テスト（1分）

```bash
# メール送信なしでテスト
npm run batch:test

# 実際にメール送信してみる
npm run batch
```

メールが届けばOK！

---

### ステップ3: タスクスケジューラの起動（30秒）

1. `Windows + R` キーを押す
2. `taskschd.msc` と入力してEnter

---

### ステップ4: 朝7時のタスク作成（2分）

#### 4-1. 基本タスクの作成
- 右側「操作」→「基本タスクの作成」

#### 4-2. 入力内容
```
名前: 投資ニュースレター配信_朝7時
説明: 全ジャンルのニュースレターを毎朝7時に配信
```

#### 4-3. トリガー
```
タスクの開始: 毎日
開始時刻: 7:00:00
間隔: 1日ごと
```

#### 4-4. 操作
```
操作: プログラムの開始
プログラム/スクリプト: C:\Users\Yuji\dev\collect-blog-articles\run-daily-newsletters.bat
開始: C:\Users\Yuji\dev\collect-blog-articles
```

#### 4-5. 完了時の設定
- ☑ 「完了をクリックしたときに、このタスクのプロパティダイアログを開く」にチェック
- 「完了」をクリック

#### 4-6. プロパティ設定（重要！）

**【全般】タブ**:
- ☑ ユーザーがログオンしているかどうかにかかわらず実行する
- ☑ 最上位の特権で実行する

**【条件】タブ**:
- ☐ AC電源で使用している場合のみ → **チェックを外す**
- ☑ タスクを実行するためにスリープを解除する → **チェックを入れる**

**【設定】タブ**:
- ☑ タスクが失敗した場合の再起動の間隔: 1分
- 再起動の試行回数: 3

**【OK】をクリック**

パスワードを求められたらWindowsのログインパスワードを入力

---

### ステップ5: 夜20時のタスク作成（2分）

ステップ4と同じ手順で、以下の点のみ変更：

```
名前: 投資ニュースレター配信_夜20時
説明: 全ジャンルのニュースレターを毎晩20時に配信
開始時刻: 20:00:00
プログラム/スクリプト: C:\Users\Yuji\dev\collect-blog-articles\run-evening-newsletters.bat
```

その他の設定は朝7時版と同じです。

---

### ステップ6: テスト実行（1分）

#### タスク一覧で確認
- タスクスケジューラライブラリに以下の2つが表示されることを確認：
  - `投資ニュースレター配信_朝7時`
  - `投資ニュースレター配信_夜20時`

#### 手動実行
1. タスクを右クリック → 「実行」
2. 数分待つ
3. メールが届くことを確認

---

## ✅ 完了！

以下のスケジュールで自動配信されます：

- **毎朝7時**: 過去24時間の全記事を全ジャンルで配信
- **毎晩20時**: 過去12時間の全記事を全ジャンルで配信

---

## 📝 ログの確認

```bash
# ログを確認
type logs\batch-newsletter.log

# 最新20行を表示
powershell -command "Get-Content logs\batch-newsletter.log -Tail 20"
```

---

## ⚙️ カスタマイズ

### 配信ジャンルを変更したい

`run-daily-newsletters.bat` を編集：

```bat
REM 個人投資家とマクロ経済のみ配信
node src\batch-newsletter.js --genres investors,macro
```

### 配信時刻を変更したい

1. タスクを右クリック → 「プロパティ」
2. 「トリガー」タブ → トリガーをダブルクリック
3. 時刻を変更

### AI分析をスキップして高速化したい

バッチファイルに `--no-ai` を追加：

```bat
node src\batch-newsletter.js --no-ai
```

---

## 🆘 トラブルシューティング

### メールが届かない

```bash
# 手動でテスト
npm run batch
```

エラーメッセージを確認して、.envファイルの設定を見直してください。

### タスクが実行されない

1. タスクスケジューラでタスクを選択
2. 下部の「履歴」タブでエラーを確認
3. タスクのプロパティで「最上位の特権で実行する」にチェックが入っているか確認

### さらに詳しいヘルプが必要

`TASK_SCHEDULER_SETUP.md` を参照してください。

---

## 🎉 以上で完了です！

毎日7時と20時に、自動的にジャンル別ニュースレターが配信されます。
